<!DOCTYPE html>
<html>
  <head>

    <link href="http://fr.allfont.net/allfont.css?fonts=montserrat-light" rel="stylesheet" type="text/css" />
    <meta charset="utf-8"/>
    <link rel="stylesheet" href="style.css" />
    <title> Tracking Map </title>


<!-- --------------------------------------------------------------
Define json and stock it in localStorage to test datas of positions
-------------------------------------------------------------------- -->
    <script type="text/javascript">

      let json = {
      "person":[
      {
        "bodyId": 145,
        "path": [
        {
          "status":"Tracking started",
          "date": "23/05/2019",
          "hour": "15:06:14",
          "Wx":-499.699,
          "Wy":136.499,
          "Wz":1296.22
        },
        {
          "status":"Tracking",
          "date": "23/05/2019",
          "hour": "15:06:15",
          "Wx":-488.701,
          "Wy":138.207,
          "Wz":1309.28
        },
        {
          "status":"Tracking",
          "date": "23/05/2019",
          "hour": "15:06:16",
          "Wx":-474.809,
          "Wy":140.564,
          "Wz":1320.75
        }
        ]
      },
      {
        "bodyId": 70,
        "path": [
        {
          "status":"Tracking started",
          "date": "23/05/2019",
          "hour": "15:06:14",
          "Wx":-399.699,
          "Wy":36.499,
          "Wz":1196.22
        },
        {
          "status":"Tracking started",
          "date": "23/05/2019",
          "hour": "15:06:14",
          "Wx":-399.699,
          "Wy":36.499,
          "Wz":1196.22
        }
        ]
      }
      ]
      
      }

      localStorage.setItem("dataCamera",JSON.stringify(json));

    </script>

  </head>


  <body>

    <div class="header" id="myHeader">
    <h2>Tracking Map</h2>
    </div>

    <canvas id="canvas"></canvas>

<!-- --------------------------------------------------------------
JS Function to draw a hot zone, a zone with lot of traffic
-------------------------------------------------------------------- -->
    <script type="text/javascript">
      function draw_hotzone() {
        var canvas = document.getElementById("canvas");

        if (canvas.getContext) {
          var ctx = canvas.getContext('2d');

          for(i=0; i<num_points; i++){
            var radgrad = ctx.createRadialGradient(45, 45, 10, 52, 50, 30);
            radgrad.addColorStop(0, '#00feff');
            radgrad.addColorStop(0.9, '#0099ff');
            radgrad.addColorStop(1, 'rgba(1, 159, 98, 0)');

            ctx.fillStyle = radgrad;
            ctx.fillRect(0, 0, 150, 150);
          }
        }
      }
    </script>



<!-- --------------------------------------------------------------
JS Function to draw client path, step by step
-------------------------------------------------------------------- -->
    <script type="text/javascript">

      //function to define randomly the color of the path 
      function getRandomInt(max) {
        return Math.floor(Math.random() * Math.floor(max));
      }


      function draw_path() {
        var canvas = document.getElementById("canvas");

        colors=new Array("orange", "blue", "red", "green", "yellow", "grey", "pink");
        
        //Read the json from 
        var string_json = localStorage.getItem("dataCamera");
        var json = JSON.parse(string_json);

        var canvas = document.getElementById('canvas');

        if (canvas.getContext) {
          var ctx = canvas.getContext('2d');

          for(p=0; p<json['person'].length; p++){
            var color_person=getRandomInt(colors.length-1);
            for(i=0; i<json['person'][p]['path'].length; i++){

              //Convert coordinates from camera reference frame in real word in cm (Wx, Wy, Wz) to Canvas reference farme in pix (Cx, Cy) with the origin in the top-left corner
              var Wx=json['person'][p]['path'][i].Wx;
              var Wz=json['person'][p]['path'][i].Wz;
              var Cx=Math.trunc(Wx/10)+(canvas.width/2);
              var Cz=canvas.height - Math.trunc(Wz/10);

              var cercle = new Path2D();
              cercle.moveTo(Cx,Cz);
              cercle.arc(Cx, Cz, 2, 0, 2 * Math.PI);
              ctx.fillStyle = colors[color_person];
              ctx.fill(cercle);
              
            
              /*
            ctx.beginPath();
            for(i=0; i<json['person'][p]['path'].length; i++){
              ctx.lineTo(Cx,Cy);
            }
            ctx.stroke();*/
          }
        }
      }
    }
    </script>

    <form>
    <input type="button" value="Draw map" class="button_draw" onclick="draw_path()"/>
    </form>

  </body>
  
</html>